
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <a class="navbar-brand" href="#">LLF</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarColor01">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/expense/">Expense</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/procurement/">Procurement</a>
          </li>
        <!-- <li class="nav-item">
          <a class="nav-link" href="/users/timesheet">Timesheet</a>
        </li> -->
        <li class="nav-item">
          <a class="nav-link" href="/users/timesheet">Timesheet</a>
        </li>
        
        <!-- <li class="nav-item">
            <a class="nav-link" href="/users/timesheet">Image Upload</a>
        </li> -->
        <li class="nav-item dropdown" style="margin-left: 800px;">
          <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-4" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
            <i class="fas fa-user "></i>&nbsp; <%= name%> </a>
          <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
            <a class="dropdown-item" href="/users/logout">Log out</a>
          </div>
        </li>
      </ul>
   
    </div>
  </nav>

  <style>
        .project-tab {
            padding: 10%;
            margin-top: -8%;
        }
        .project-tab #tabs{
            background: #007b5e;
            color: #eee;
        }
        .project-tab #tabs h6.section-title{
            color: #eee;
        }
        .project-tab #tabs .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
            color: #0062cc;
            background-color: transparent;
            border-color: transparent transparent #f3f3f3;
            border-bottom: 3px solid !important;
            font-size: 16px;
            font-weight: bold;
        }
        .project-tab .nav-link {
            border: 1px solid transparent;
            border-top-left-radius: .25rem;
            border-top-right-radius: .25rem;
            color: #0062cc;
            font-size: 16px;
            font-weight: 600;
        }
        .project-tab .nav-link:hover {
            border: none;
        }
        .project-tab thead{
            background: #f3f3f3;
            color: #333;
        }
        .project-tab a{
            text-decoration: none;
            color: #333;
            font-weight: 600;
        }
        .accordion {
            max-height: 500px;
            overflow-y: auto;
        }

        section {
            padding: 60px 0;
        }

        #accordion-style-1 h1,
        #accordion-style-1 a {
            color: #007b5e;
        }

        #accordion-style-1 .btn-link {
            font-weight: 400;
            color: #007b5e;
            background-color: transparent;
            text-decoration: none !important;
            font-size: 16px;
            font-weight: bold;
            padding-left: 25px;
        }

        #accordion-style-1 .card-body {
            border-top: 2px solid #007b5e;
        }

        #accordion-style-1 .card-header .btn.collapsed .fa.main {
            display: none;
        }

        #accordion-style-1 .card-header .btn .fa.main {
            background: #007b5e;
            padding: 13px 11px;
            color: #ffffff;
            width: 35px;
            height: 41px;
            position: absolute;
            left: -1px;
            top: 10px;
            border-top-right-radius: 7px;
            border-bottom-right-radius: 7px;
            display: block;
        }

        .rotate {
            -webkit-transform: rotate(90deg);
            /* Chrome, Safari, Opera */
            -moz-transform: rotate(90deg);
            /* Firefox */
            -ms-transform: rotate(90deg);
            /* IE 9 */
            transform: rotate(90deg);
            /* Standard syntax */
        }

        ul.liststyle {
            padding: 0;
            list-style: none;
        }

        ul.liststyle li {
            padding: 5px;
        }
        #pettyCashModal{right: 0; margin: auto;}
        /*@media (min-width: 850px) {
            .modal-xl {
                width: 90%;
                max-width:950px;
            }
        }*/
    </style>

<div class="container-fluid bg-gray" id="accordion-style-1">
        <p id="expenseIdpTag"> </p>
    <div class="container">
        <section>
                
            <div class="row">
                    <form class="container-fluid bg-gray">
                            <div class="form-row mb-4 col-10 mx-auto">
                                    <div class="col form-inline" >
                                        <input class="form-control form-control-sm mr-3 w-75" type="text" placeholder="Search"
                                            aria-label="Search"> 
                                    </div>
                                    <div class="col">
                                        <button class="btn btn-primary btn-block bg-gray" type="button" id="createNewExpenseButton">Create New Expense</button>
                                    </div>
                            </div>
                    </form>
                <div class="col-10 mx-auto table-responsive  table-wrap">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Expense Name</th>
                                <th>Project </th>
                                <th>Approval Status</th>
                                <th>Amount Claimed</th>
                                <th>Petty Cash Amount</th>
                                <th>Conveyance Amount</th>
                                <th>Tour Bill Claim Amount</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if(expenseList.length > 0) { %>
                            <% expenseList.forEach(function(eachExpense) { %>
                                <tr>
                                        <td><a href="<%= eachExpense.sfid %>" data-toggle="modal" data-target="#popup" class="expId" id="" ><%= eachExpense.name %></a></td>
                                         <!-- <td><%= eachExpense.project_name__c %></td> -->
                                        <td>Project 6</td> 
                                        <td><%= eachExpense.approval_status__c %></td>
                                        <td><%= eachExpense.amount_claimed__c %></td>
                                        <td><%= eachExpense.petty_cash_amount__c %></td>
                                        <td><%= eachExpense.conveyance_amount__c %></td>
                                        <td><%= eachExpense.tour_bill_claim_amount__c %></td>
                                        <td><a href="#"  data-toggle="modal" data-target="#popupEdit" class="btn btn-primary expIdEditMode"  style="color:white;" id="<%= eachExpense.sfid %>" >Edit</a></td>
                                </tr>
                            <% }) %>
                            <% }%>
                           
                        </tbody>
                    </table>
                    <div class="modal fade" id="popup">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">

                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title">Expense Name </h4>
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>

                                <!-- Modal body -->
                                <div class="modal-body">
                                   <div class="row">
                <div class="col-md-12">
                    <nav>
                        <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                            <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Details</a>
                            <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Related</a>
                        </div>
                    </nav>
                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                           <!-- Particular Expense Details -->
                                <table id="expenseTable" class="table table-hover striped">
                                        <!-- Inside code is handled by Jquery to add dyanamic Content -->
                                </table>
                            <!-- Particular Expense Details-->
                        </div>
                        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                            <div class="accordion" id="accordionExample">
                                <div class="card">
                                    <div class="card-header" id="headingOne">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link text-left" type="pettyCashButton"
                                                data-toggle="collapse" data-target="#collapseOne"
                                                aria-expanded="true" aria-controls="collapseOne">
                                                <i class="fa fa-angle-double-right mr-3"></i>Petty Cash
                                            </button>
                                             <!-- <button class="btn btn-primary float-right" id="pettyCashButton" >New</button> -->
                                            <a href="#" class="btn btn-primary float-right pettyCashButton" id="" style="color:white;" >New</a>
                                        </h5>
                                    </div>

                                    <div id="collapseOne" class="collapse show fade"
                                        aria-labelledby="headingOne" data-parent="#accordionExample">
                                        <div class="card-body">
                                            <table id="pettyCashTable" class="table table-hover striped">
                                                <thead>
                                                    <th>Petty Cash Expense Name</th>
                                                    <th>Amount</th>
                                                    <th>Activity code</th>
                                                    <th>Nature Of Expense</th>
                                                    <th>Bill Date</th>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header" id="headingTwo">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link collapsed text-left" type="button"
                                                data-toggle="collapse" data-target="#collapseTwo"
                                                aria-expanded="false" aria-controls="collapseTwo">
                                                <i class="fa fa-angle-double-right mr-3"></i>Conveyance Voucher
                                            </button>
                                            <!-- <button class="btn btn-primary float-right">New</button> -->
                                            <a href="#" class="btn btn-primary float-right conveyanceVoucherButton" style="color:white;">New</a>
                                        </h5>
                                    </div>
                                    <div id="collapseTwo" class="collapse fade" aria-labelledby="headingTwo"
                                        data-parent="#accordionExample">
                                        <div class="card-body">
                                                <table id="conveyanceVoucherTable" class="table table-hover striped">
                                                      <thead>
                                                            <th>Conveyance Voucher ID</th>
                                                            <th>Amount</th>
                                                            <th>Mode Of Conveyance</th>
                                                            <th>From</th>
                                                        </thead>
                                                    </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header" id="headingThree">
                                        <h5 class="mb-0">
                                            <button class="btn btn-link collapsed text-left" type="button"
                                                data-toggle="collapse" data-target="#collapseThree"
                                                aria-expanded="false" aria-controls="collapseThree">
                                                <i class="fa fa-angle-double-right mr-3"></i>Tour Bill Claim
                                            </button>
                                            <!-- <button class="btn btn-primary float-right">New</button> -->
                                            <a href="#" class="btn btn-primary float-right tourBillClaim" style="color:white;" id="tourBillClaim">New</a>
                                        </h5>
                                    </div>
                                    <div id="collapseThree" class="collapse fade"
                                        aria-labelledby="headingThree" data-parent="#accordionExample">
                                        <div class="card-body">
                                                <table id="tourBillClaimTable" class="table  table-hover striped">
                                                        <thead>
                                                            <th>Tour Bill Claim Name</th>
                                                            <th>Grand Total</th>
                                                        </thead>
                                                </table>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                                  
                                </div>

                                <!-- Modal footer -->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-dismiss="modal">Close</button>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </div>
</div>



<!-- Create Expense Modal -->
<div id="createExpenseModal" class="modal fade bs-example-modal-lg" tabindex ="-1" role="dialog" aria-labelledby="myLargeModalLabel" >
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="createTaskModal">Create New Expense</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form  id="taskForm" class="needs-validation" novalidate >
    
                <div class="form-group">  
                  <div class="row">
                    <div class="col-md-6">
                      <label for="validationTooltip01">Expense Name</label>
                      <input type="text" class="form-control" id="validationTooltip01" value="" placeholder="Task Name"  name="taskname" required>
                    </div>
                   
                    <div class="col-md-6">
                      <label for="validationTooltip03">Project Name</label>
                      <select class="custom-select custom-select-sm form-control" name="projectname">
                        <% if(projectList.length != 0) { %>
                         <% projectList.forEach((eachProject) => { %>
                         <option selected value="<%= eachProject.sfid %>" ><%= eachProject.name %></option>
                         <% }) %>
                        <% } %>
                     </select>
                    </div>
                  </div>
                </div>
    
                <div class="form-group"> 
                  <div class="row">
                    <div class="col-md-6">
                      <label for="validationTooltip03">Department</label>
                      <input type="text" class="form-control" id="validationTooltip03" placeholder="Deaprtment"  name="department" >
                    </div>
                    <div class="col-md-6">
                      <label for="validationTooltip04">Designation</label>
                      <input type="text" class="form-control" id="validationTooltip04" placeholder="Designation"  name="designation" >
                    </div>
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <label for="validationTooltip05">Employee ID</label>
                      <input type="text" class="form-control" id="validationTooltip05" placeholder="Employee ID"  name="employeeId" >
                    </div>
    
                    <div class="col-md-6">
                      <label for="validationTooltip06">Employee Category / Band</label>
                      <input type="text" class="form-control" id="validationTooltip06" placeholder="Employee Category / Band"  name="empCategory" >
                    </div>
                  </div>  
                </div>
                
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <label for="validationTooltip07">Approval Status</label>
                      <select disabled="true" class="custom-select custom-select-sm form-control" name="approvalStatus" id="validationTooltip07">
                            <option value="None" selected>None</option>
                            <option value="Pending">Pending</option>
                            <option value="Approved">Approved</option>
                            <option value="Rejected">Rejected</option>
                       </select>
                    </div>
                    
                    <div class="col-md-6">
                      <label for="validationTooltip08">Incurred By</label>
                      <select class="custom-select custom-select-sm form-control" name="incurredBy">
                         <option selected value="<%= objUser.sfid %>" ><%= objUser.name %></option>
                     </select>
                    </div>
                  </div>  
                </div>
    
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit" id="expenseSubmitbutton"  class="btn btn-primary">Save</button>
                </div>
    
              </form>
            </div>
            
          </div>
        </div>
      </div>



<!--  Edit Expense Modal -->      

<div class="modal fade" id="popupEdit">
  <div class="modal-dialog modal-lg">
      <div class="modal-content">
            <!-- Header -->
            <div class="modal-header">
              <h5 class="modal-title" id="createTaskModal">Create New Expense</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <!-- Body -->
            <div class="modal-body" id="expenseEditModalBody">
                <h5>Hello Expense Edit </h5>
                
            </div>

            <!-- Footer -->
            
      </div>
  </div>
</div>
    

<!--Petty Cash Modal-->
<div id="" class="modal fade modal-xl" tabindex ="-1" role="dialog" aria-labelledby="myLargeModalLabel" >
        <div class="modal-dialogmodal-xl" role="document" id="internalDiv">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="createTaskModal">Fill Petty Cash Expense</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="pettyCashClose">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                        <div class="container">
                                <br />
                                <h4 align="center">Enter Petty Cash Details</h4>
                                <br />
                                <form method="post" action="/insertprecash" id="formdata"  enctype="multipart/form-data">
                                 <div class="table-repsonsive">
                                  <span id="error"></span>
                                  <table class="table table-bordered" id="item_table">
                                   <tr>
                                    <th>SLIP NO</th>
                                    <th>BILL NO.</th>
                                    <th>BILL DATE</th>
                                    <th>ACTIVITY CODE</th>
                                    <th>DESCRIPTION OF ACTIVITY EXPENSES</th>
                                    
                             
                                    <th>NATURE OF EXP</th>
                                    <th>AMOUNT</th>
                                    <th>FILE</th>
                                    <th><button type="button" name="add" class="btn btn-success btn-sm add"><span class="glyphicon glyphicon-plus"></span></button></th>
                                   </tr>
                                  </table>
                                  <div align="center">
                                 
                                   <<!-- input type="submit" name="submit" class="btn btn-info" value="Submit" /> -->
                                  </div>
                                 </div>
                             </form>
                        </div>
                  </div>

                  <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" id="pettyCashClose">Close</button>
                        <button type="submit" id="submitbutton" class="btn btn-primary">Save</button>
                 </div>
                 </div>
        </div>   
</div>



<div id="createTourBillClaim" class="modal fade bs-example-modal-lg" tabindex ="-1" role="dialog" aria-labelledby="myLargeModalLabel" >
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createTaskModal">Create New Tour Bill Claim</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form  id="taskForm" class="needs-validation" novalidate >

          <div class="form-group">  
              <div class="row">
                <div class="col-md-6">
                  <label for="validationTooltip01">Tour Bill Claim Name</label>
                  <input type="text" class="form-control" id="validationTooltip01" value="" placeholder="Task Name"  name="taskname" required>
                </div>
            </div>
          </div>   

            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="submit" id="expenseSubmitbutton"  class="btn btn-primary">Save</button>
            </div>

          </form>
        </div>
        
      </div>
    </div>
  </div>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

<script>
    $(".collapse").on('show.bs.collapse', function () {
        $(this).parent().find(".fa-angle-double-right").addClass("rotate");
    }).on('hide.bs.collapse', function () {
        $(this).parent().find(".fa-angle-double-right").removeClass("rotate");
    });

   
        $(document).ready(function(){
          //  alert('hello');
          $('#expenseIdpTag').hide();

          $("a.pettyCashButton").click(() => {
            console.log('Petty Cash Anchor Tag');
            var expenseId = document.getElementById('expenseIdpTag').innerHTML;
            console.log('Inside PettyCash Anchor Tag expenseId  '+expenseId);
            location.assign('/expense/pettyCash/'+expenseId);
          });


          $("a.conveyanceVoucherButton").click(() => {
            console.log('conveyanceVoucherButton Anchor Tag');
            var expenseId = document.getElementById('expenseIdpTag').innerHTML;
            console.log('Inside conveyanceVoucherButton Anchor Tag expenseId  '+expenseId);
            location.assign('/expense/conveyanceVoucher/'+expenseId);
          });

          $("a.tourBillClaim").click(() => {
            console.log('tourBillClaimButton Anchor Tag');
            var expenseId = document.getElementById('expenseIdpTag').innerHTML;
            console.log('Inside conveyanceVoucherButton Anchor Tag expenseId  '+expenseId);
            location.assign('/expense/tourBillClaim/'+expenseId);
          });



          $("a.expId").click(function(){
            
            var expenseId = $(this).attr('href');
            console.log('expenseId   : '+expenseId);
            document.getElementById('expenseIdpTag').innerHTML = expenseId;
        //     alert(expenseId); 

            $.ajax({
                type : 'GET',
                url  : '/expense/details',
                data : {
                    'expenseId' : expenseId
                },
                dataType : 'json'
            })
            .done((expenseRelatedData) => {
               // console.log('Expense Data '+data);
            //    console.log('expense data '+JSON.stringify(expenseRelatedData));
                let expenseRecord = expenseRelatedData.Expense[0];
                console.log('expenseList  '+JSON.stringify(expenseRecord));

                let expenseTableRows = '';
                expenseTableRows += '<tr>';
                expenseTableRows += '<td><strong>Expense Name<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.name+'</td>';
                expenseTableRows += '<td><strong>Project Name<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.project_name__c+'</td>';
                expenseTableRows += '</tr>';   
                
                expenseTableRows += '<tr>';
                expenseTableRows += '<td><strong>Department<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.department__c+'</td>';
                expenseTableRows += '<td><strong>Designation<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.designation__c+'</td>';
                expenseTableRows += '</tr>';   

                expenseTableRows += '<tr>';
                expenseTableRows += '<td><strong>Employee ID<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.conveyance_voucher_employee_id__c+'</td>';
                expenseTableRows += '<td><strong>Employee Category / Band<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.conveyance_employee_category_band__c+'</td>';
                expenseTableRows += '</tr>';   

                expenseTableRows += '<tr>';
                expenseTableRows += '<td><strong>Approval Status<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.approval_status__c+'</td>';
                expenseTableRows += '<td><strong><strong></td>';
                expenseTableRows += '<td>'+' '+'</td>';
                expenseTableRows += '</tr>';   

                expenseTableRows += '<tr>';
                expenseTableRows += '<td colspan="4" style="background-color:#d3d3d3;"><h5>Amount Information</h5></td>';    
                expenseTableRows += '</tr>';

                expenseTableRows += '<tr>';
                expenseTableRows += '<td><strong>Amount Claimed<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.amount_claimed__c+'</td>';
                expenseTableRows += '<td><strong>Petty Cash Amount<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.petty_cash_amount__c+'</td>';
                expenseTableRows += '</tr>'; 

                expenseTableRows += '<tr>';
                expenseTableRows += '<td><strong>Conveyance Amount<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.conveyance_amount__c+'</td>';
                expenseTableRows += '<td><strong>Tour Bill Claim Amount<strong></td>';
                expenseTableRows += '<td>'+expenseRecord.tour_bill_claim_amount__c+'</td>';
                expenseTableRows += '</tr>';   

                //$('#expenseTable').append(expenseTableRows);
                $('#expenseTable').html(expenseTableRows);


                
                let pettyCashList = expenseRelatedData.PettyCash;
                console.log('pettyCashList  '+JSON.stringify(pettyCashList));

                let pettyCashTableRows = '';
                pettyCashList.forEach((eachPettyCash) => {
                    var strDate = eachPettyCash.bill_date__c.toString().split('T')[0];
                    pettyCashTableRows += '<tr>';
                    pettyCashTableRows += '<td>'+eachPettyCash.name+'</td>';
                    pettyCashTableRows += '<td>'+eachPettyCash.amount__c+'</td>';
                    pettyCashTableRows += '<td>'+eachPettyCash.activity_code__c+'</td>';
                    pettyCashTableRows += '<td>'+eachPettyCash.nature_of_exp__c+'</td>';
                    pettyCashTableRows += '<td>'+strDate+'</td>';
                    pettyCashTableRows += '</tr>';
                });
              //  pettyCashTableRows = '</tbody>';
                $('#pettyCashTable').append(pettyCashTableRows);
             // $('#pettyCashTable').html(pettyCashTableRows);

                let conveyanceVoucherList =  expenseRelatedData.Conveyance;
                console.log('conveyanceVoucherList  '+JSON.stringify(conveyanceVoucherList));

                let conveyanceVoucherTableRows = '';
                conveyanceVoucherList.forEach((eachConveyance) => {
                    var strDate = eachConveyance.from__c.toString().split('T')[0];
                    conveyanceVoucherTableRows += '<tr>';
                    conveyanceVoucherTableRows += '<td>'+eachConveyance.name+'</td>';
                    conveyanceVoucherTableRows += '<td>'+eachConveyance.amount__c+'</td>';
                    conveyanceVoucherTableRows += '<td>'+eachConveyance.mode_of_conveyance__c+'</td>';
                    conveyanceVoucherTableRows += '<td>'+strDate+'</td>';
                    conveyanceVoucherTableRows += '</tr>';
                })

                $('#conveyanceVoucherTable').append(conveyanceVoucherTableRows);
              //  $('#conveyanceVoucherTable').html(conveyanceVoucherTableRows);

                let tourBillClaimList = expenseRelatedData.TourBillClaim;
                console.log('tourBillClaimList  '+JSON.stringify(tourBillClaimList));

                let tourBillClaimTableRows = '';
                tourBillClaimList.forEach((eachTourBillClaim) => {
                    tourBillClaimTableRows += '<tr>';
                    tourBillClaimTableRows += '<td>'+eachTourBillClaim.name+'</td>';
                    tourBillClaimTableRows += '<td>'+eachTourBillClaim.grand_total__c+'</td>';
                    tourBillClaimTableRows += '</tr>';
                })

                $('#tourBillClaimTable').append(tourBillClaimTableRows);
               // $('#tourBillClaimTable').html(tourBillClaimTableRows);

            })
            .fail((jqXHR, textStatus, err) => {
                console.log('AJAX error response :',textStatus);
            })


            $("#popup").modal("show");
                return false;
          });

          $('a.expIdEditMode').click(function(){
              let expenseId = $(this).attr('id');
              
              $.ajax({
                  url : '/expense/saved-expense-details',
                  data: {
                    expenseId : expenseId
                  },
                  dataType : 'json'
              })
              .done((response) => {
                    console.log('response  : '+JSON.stringify(response));
                    let expenseDetails = response.expenseDetails;
                    let objUser = response.objUser;
                    let projectList = response.projectList;
                    let projectOptionsHtml = '';
                    if(projectList.length > 0)
                    {
                        projectList.forEach((eachProject) =>
                        {
                          if(eachProject.sfid == expenseDetails.project_name__c)
                              projectOptionsHtml += '<option selected value="'+eachProject.sfid+'">'+eachProject.name+'</option>';
                          else
                              projectOptionsHtml += '<option value="'+eachProject.sfid+'">'+eachProject.name+'</option>'; 
                        })
                    }

                    let expenseEdithtml = '<form  id="taskFormEdit" class="needs-validation" novalidate >'+
                        '<div class="form-group">'+  
                          '<div class="row">'+
                            '<div class="col-md-6">'+
                              '<label for="validationTooltip01">Expense Name</label>'+
                              '<input type="text" class="form-control" id="validationTooltip01" value="'+expenseDetails.name+'" placeholder="Task Name"  name="taskname" required>'+
                            '</div>'+
                           
                            '<div class="col-md-6">'+
                            '<label for="validationTooltip03">Project Name</label>'+
                             '<select class="custom-select custom-select-sm form-control" name="projectname">'+
                                projectOptionsHtml+
                             '</select>'+
                            '</div>'+
                          '</div>'+
                        '</div>'+            
                      
                      '<div class="form-group">'+
                          '<div class="row">'+
                            '<div class="col-md-6">'+
                              '<label for="validationTooltip03">Department</label>'+
                              '<input type="text" class="form-control" id="validationTooltip03" value="'+expenseDetails.department__c+'" placeholder="Deaprtment"  name="department" >'+
                            '</div>'+
                            '<div class="col-md-6">'+
                              '<label for="validationTooltip04">Designation</label>'+
                              '<input type="text" class="form-control" id="validationTooltip04" value="'+expenseDetails.designation__c+'" placeholder="Designation"  name="designation" >'+
                            '</div>'+
                          '</div>'+
                        '</div>'+
                        
                        '<div class="form-group">'+
                          '<div class="row">'+
                            '<div class="col-md-6">'+
                              '<label for="validationTooltip05">Employee ID</label>'+
                              '<input type="text" class="form-control" id="validationTooltip05" value="'+expenseDetails.conveyance_voucher_employee_id__c+'" placeholder="Employee ID"  name="employeeId" >'+
                            '</div>'+
            
                            '<div class="col-md-6">'+
                              '<label for="validationTooltip06">Employee Category / Band</label>'+
                              '<input type="text" class="form-control" id="validationTooltip06" value="'+expenseDetails.conveyance_employee_category_band__c+'" placeholder="Employee Category / Band"  name="empCategory" >'+
                            '</div>'+
                          '</div>'+
                        '</div>'+
                        
                        '<div class="form-group">'+
                          '<div class="row">'+
                            '<div class="col-md-6">'+
                              '<label for="validationTooltip07">Approval Status</label>'+
                              '<select disabled="true" class="custom-select custom-select-sm form-control" name="approvalStatus" id="validationTooltip07">'+
                                    '<option value="'+expenseDetails.approval_status__c+'" selected>'+expenseDetails.approval_status__c+'</option>'+
                               '</select>'+
                            '</div>'+
                            
                            '<div class="col-md-6">'+
                              '<label for="validationTooltip08">Incurred By</label>'+
                              '<select class="custom-select custom-select-sm form-control" name="incurredBy">'+
                                 '<option selected value="'+objUser.sfid+'" >'+objUser.name+'</option>'+
                             '</select>'+
                            '</div>'+
                          '</div>'+  
                      '</div>'+
                      '<input type="hidden"  value="'+expenseDetails.sfid+'"  name="expenseId">' +
                      '<div class="modal-footer">'+
                          '<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>'+
                          '<button type="submit" id="expenseEditSubmitbutton"  class="btn btn-primary">Save</button>'+
                      '</div>'+
                      '</form>';
                        

                  
                  $('#expenseEditModalBody').empty();
                  $('#expenseEditModalBody').append(expenseEdithtml); 


                  $('#expenseEditSubmitbutton').click(function(){
                      alert('HJJJJJ');
                        $('#taskFormEdit').submit(function(e){
                          alert('Form Going to Submit');
                          e.preventDefault();
                          var values = $(this).serialize();
                          console.log('Expense Updated Form Values : '+values);
                          $.ajax({
                            url :'/expense/update-expense',
                            type: 'post',
                            data : values,
                            dataType: 'json'
                          })
                          .done((response) => {
                              console.log('Expense Creation Response : '+JSON.stringify(response));    
                          })
                          .fail((xhr, status, error)=> {
                              console.log('xhr.responseText : '+xhr.responseText);
                              if(xhr.responseText == 'Success')
                              {
                                  alert('Expense Created Successfully !');
                              }
                              else if(xhr.responseText == 'Error')
                              {
                                  alert('There occurred an error while creating expense !');
                              }
                          })
                      })
                  });
                   
              })
              .fail((jqXHR, status, error) => {
                    console.log('Error  : '+JSON.stringify(jqXHR));
              })

          });

          $('#createNewExpenseButton').click(() =>{
                $('#createExpenseModal').modal('show');
          })

    });
</script>



<script>
        $(document).ready(function(){


            $('#taskForm').submit(function(e){
                e.preventDefault();
              //  alert('Going to create expnse');
                var values = $(this).serialize();
                console.log('Expense Form Values : '+values);
                $.ajax({
                  url :'/expense/createExpense',
                  type: 'post',
                  data : values,
                  dataType:'json'
                })
                .done((response) => {
                    console.log('Expense Creation Response : '+JSON.stringify(response));
                    
                    
                })
                .fail((xhr, status, error)=> {
                   // alert('There occurred an error while creating expense !');
                    console.log('xhr.responseText : '+xhr.responseText);
                    if(xhr.responseText == 'Success')
                    {
                        alert('Expense Created Successfully !');
                        $('#createExpenseModal').modal('hide');
                    }
                    else if(xhr.responseText == 'Error')
                    {
                        alert('There occurred an error while creating expense !');
                    }
                })
            })



          
            $('#pettyCashButton').click(() => {
                
                $('#pettyCashModal').modal('show');
            });
            $('#pettyCashClose').click(() =>{
              // alert('hello');
              // $('#internalDiv').css({"display" : "none"});
              //$('#pettyCashModal').modal('toggle');
            })


         var count = 1
         $(document).on('click', '.add', function(){
            var cnt = count++;
            var html = '';
            html += '<tr>';
            html += '<td>'+cnt+'</td>';
            html += '<td><input type="text" name="bill_no[]" class="form-control" /></td>';
            html += '<td><input type="date" name="bill_date[]" class="form-control " /></td>';
            html += '<td><select name="activity_code[]" class="form-control item_unit"><option value="1">Act/01/01/it/001</option><option value="2">Act/01/01/it/002</option></select></td>';
            html += '<td><textarea  name="desc[]" class="form-control"></textarea></td>';
            html += '<td><input type="text" name="nature_exp[]" class="form-control" /></td>';
            html += '<td><input type="text" name="amount[]" class="form-control" /></td>';
            html += '<td><input type="file" onChange="chkFile(this,'+cnt+')" name="fileprety[]" id="fileprety" class="form-control" /><input type="hidden" value="demo" name="imgpath[]" id="file_'+cnt+'"></td>';
            html += '<td><button type="button" name="remove" class="btn btn-danger btn-sm remove"><span class="glyphicon glyphicon-minus"></span></button></td></tr>';
            $('#item_table').append(html);
         });
         
         $(document).on('click', '.remove', function(){
            $(this).closest('tr').remove();
         });
        
        });
        
        
        $(function () {
          $('form#formdata').bind('submit', function () {
            $.ajax({
              type: 'post',
              url: '/insertprecash',
              data: $('form#formdata').serialize(),
              success: function (data) {
                console.log(data);
                alert(data);
              }
            });
            return false;
          });
        });
        
        
        function chkFile(file1,id) {
            var file = file1.files[0];
            var formData = new FormData();
            formData.append('formData', file);
        
           
            $.ajax({
            type: "POST",
            url: "/pettycash",    
            cache: false,
            dataType:'json',
            processData: false,
            contentType: false,
            data: formData,
            success: function (data) {
              console.log(data);
            //  var result = JSON.stringify(data)
             $('#file_'+id).val(data.url);
             
              }
          });
        }
</script>


